<!DOCTYPE html>
<html>
<head>
    <title>debug page</title>
    <meta charset='utf-8'>
    <style>
        body { margin: 0; padding: 0;}
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script src='../src/earcut.js'></script>
    <script>
        var testPoints = [[881,-119],[887,-106],[887,-95],[883,-75],[882,-54],[879,-30],[875,-6],[865,15],[854,40],[847,55],[842,72],[839,91],[830,115],[817,147],[808,171],[798,181],[789,194],[782,209],[783,221],[781,231],[782,247],[779,259],[781,279],[783,299],[789,329],[795,352],[803,382],[803,403],[808,421],[815,448],[824,478],[830,502],[845,545],[858,583],[866,620],[875,630],[884,642],[888,649],[888,666],[890,683],[893,703],[901,725],[908,753],[907,762],[909,776],[917,798],[925,817],[931,825],[932,832],[932,847],[937,863],[946,875],[945,885],[944,898],[945,910],[951,923],[959,933],[967,947],[973,960],[975,969],[985,982],[987,990],[995,1008],[1003,1033],[1016,1058],[1024,1067],[1026,1085],[1030,1094],[1040,1099],[1041,1104],[1041,1119],[1040,1137],[1039,1151],[1043,1166],[1046,1184],[1047,1197],[1052,1205],[1063,1220],[1067,1232],[1070,1247],[1078,1260],[1089,1266],[1101,1271],[1116,1284],[1131,1287],[1144,1293],[1156,1301],[1171,1304],[1184,1310],[1196,1317],[1212,1318],[1229,1321],[1239,1329],[1252,1337],[1268,1345],[1278,1350],[1288,1360],[1296,1362],[1306,1362],[1323,1361],[1340,1370],[1343,1378],[1345,1389],[1358,1401],[1370,1395],[1380,1398],[1389,1402],[1399,1404],[1399,1413],[1400,1426],[1413,1436],[1423,1439],[1437,1438],[1445,1448],[1451,1456],[1461,1461],[1478,1469],[1491,1473],[1504,1472],[1515,1470],[1527,1470],[1543,1472],[1553,1479],[1567,1492],[1576,1510],[1582,1521],[1591,1535],[1595,1546],[1603,1560],[1612,1569],[1624,1573],[1633,1571],[1645,1569],[1660,1570],[1669,1567],[1680,1576],[1688,1582],[1698,1587],[1700,1601],[1708,1607],[1716,1619],[1719,1635],[1717,1645],[1715,1653],[1725,1665],[1738,1671],[1755,1685],[1767,1694],[1783,1699],[1802,1702],[1822,1705],[1836,1703],[1847,1697],[1853,1684],[1861,1671],[1863,1655],[1861,1643],[1855,1634],[1849,1626],[1848,1618],[1856,1614],[1858,1622],[1876,1630],[1887,1634],[1896,1638],[1910,1637],[1928,1621],[1940,1606],[1954,1584],[1958,1565],[1957,1546],[1958,1536],[1971,1508],[1986,1480],[1995,1452],[2006,1420],[2018,1389],[2031,1359],[2048,1333],[2063,1316],[2083,1301],[2107,1289],[2136,1272],[2156,1266],[2171,1264],[2179,1262],[2193,1271],[2207,1281],[2224,1287],[2242,1292],[2252,1296],[2260,1302],[2269,1313],[2285,1327],[2300,1337],[2312,1345],[2323,1354],[2328,1362],[2331,1373],[2341,1382],[2354,1391],[2369,1398],[2383,1408],[2398,1419],[2411,1429],[2419,1440],[2427,1454],[2436,1491],[2444,1506],[2450,1516],[2460,1520],[2478,1524],[2490,1529],[2509,1537],[2548,1552],[2577,1569],[2582,1581],[2595,1593],[2606,1596],[2618,1606],[2628,1618],[2634,1631],[2635,1646],[2635,1657],[2634,1673],[2632,1684],[2631,1692],[2637,1704],[2646,1701],[2651,1692],[2659,1686],[2670,1693],[2672,1701],[2676,1714],[2682,1728],[2681,1739],[2678,1750],[2677,1759],[2689,1768],[2700,1777],[2702,1786],[2701,1797],[2702,1813],[2707,1822],[2718,1827],[2724,1835],[2734,1846],[2739,1854],[2752,1863],[2761,1863],[2771,1858],[2779,1875],[2781,1894],[2789,1914],[2810,1946],[2835,1977],[2850,2004],[2876,2035],[2896,2059],[2903,2067],[2910,2080],[2916,2103],[2917,2129],[2919,2138],[2927,2137],[2938,2135],[2958,2142],[2980,2148],[2998,2151],[3025,2150],[3065,2154],[3095,2153],[3120,2144],[3133,2140],[3145,2138],[3154,2138],[3168,2145],[3175,2153],[3181,2162],[3190,2169],[3199,2171],[3211,2173],[3228,2172],[3242,2171],[3258,2175],[3275,2177],[3294,2179],[3324,2181],[3358,2178],[3393,2174],[3422,2170],[3468,2176],[3500,2179],[3517,2183],[3533,2183],[3553,2192],[3580,2205],[3597,2216],[3611,2230],[3620,2244],[3623,2263],[3627,2290],[3635,2317],[3644,2355],[3650,2368],[3655,2379],[3668,2380],[3687,2385],[3704,2389],[3727,2390],[3747,2386],[3769,2379],[3788,2371],[3802,2360],[3812,2341],[3828,2310],[3862,2232],[3884,2189],[3914,2139],[3935,2114],[3951,2088],[3967,2074],[3976,2064],[3990,2064],[4000,2064],[4009,2062],[4019,2052],[4045,2030],[4070,2003],[4095,1973],[4126,1938],[4150,1911],[4168,1903],[4183,1899],[4198,1888],[4203,1880],[4224,1869],[4224,4224],[4224,2849],[4215,2861],[4190,2867],[4176,2873],[4160,2879],[4140,2883],[4113,2886],[4103,2889],[4090,2890],[4078,2882],[4051,2875],[4012,2861],[3979,2856],[3956,2856],[3940,2854],[3926,2850],[3915,2846],[3893,2834],[3879,2815],[3870,2797],[3855,2786],[3841,2777],[3817,2771],[3799,2772],[3778,2773],[3756,2767],[3731,2762],[3711,2756],[3690,2742],[3671,2728],[3657,2718],[3644,2709],[3619,2703],[3591,2699],[3566,2700],[3546,2696],[3522,2690],[3504,2679],[3486,2668],[3471,2657],[3453,2648],[3436,2644],[3414,2646],[3399,2654],[3378,2651],[3360,2652],[3341,2659],[3321,2665],[3302,2673],[3274,2674],[3246,2670],[3223,2666],[3201,2663],[3177,2655],[3148,2644],[3109,2629],[3090,2619],[3064,2610],[3036,2602],[3006,2587],[2983,2576],[2958,2557],[2932,2536],[2901,2510],[2881,2491],[2851,2470],[2823,2445],[2800,2424],[2781,2403],[2758,2372],[2736,2345],[2717,2318],[2695,2287],[2681,2251],[2666,2188],[2652,2132],[2638,2065],[2628,2038],[2620,2001],[2606,1968],[2590,1937],[2570,1907],[2558,1892],[2549,1873],[2532,1831],[2519,1797],[2508,1772],[2493,1751],[2475,1727],[2454,1704],[2433,1683],[2419,1672],[2400,1667],[2386,1662],[2377,1665],[2364,1669],[2356,1685],[2346,1695],[2330,1710],[2301,1724],[2285,1726],[2269,1725],[2251,1719],[2233,1716],[2220,1715],[2199,1723],[2183,1737],[2174,1756],[2164,1776],[2151,1800],[2150,1819],[2148,1834],[2140,1850],[2130,1862],[2113,1866],[2098,1877],[2088,1899],[2083,1920],[2083,1930],[2081,1944],[2069,1951],[2062,1960],[2052,1976],[2037,2004],[2022,2033],[2011,2052],[2003,2068],[1985,2090],[1973,2100],[1962,2105],[1944,2103],[1929,2090],[1918,2074],[1907,2056],[1896,2039],[1880,2025],[1861,2017],[1844,2013],[1826,2002],[1811,1980],[1794,1952],[1773,1927],[1755,1899],[1731,1860],[1709,1841],[1692,1815],[1678,1789],[1664,1776],[1651,1767],[1634,1742],[1611,1704],[1590,1680],[1566,1656],[1546,1637],[1531,1628],[1523,1627],[1510,1613],[1496,1601],[1483,1588],[1476,1573],[1481,1563],[1485,1553],[1484,1545],[1473,1535],[1465,1535],[1457,1530],[1441,1508],[1426,1498],[1414,1493],[1400,1491],[1380,1487],[1368,1484],[1359,1477],[1345,1464],[1335,1459],[1326,1441],[1319,1432],[1304,1426],[1293,1426],[1277,1423],[1268,1416],[1252,1407],[1234,1397],[1223,1391],[1202,1386],[1192,1381],[1183,1376],[1171,1377],[1155,1379],[1143,1379],[1120,1379],[1111,1381],[1102,1381],[1092,1375],[1083,1369],[1070,1349],[1061,1338],[1047,1335],[1035,1328],[1020,1315],[1010,1305],[1005,1292],[1004,1275],[996,1241],[987,1213],[980,1194],[979,1180],[978,1162],[970,1135],[956,1097],[942,1056],[925,1007],[913,978],[898,954],[888,927],[882,895],[873,863],[867,834],[855,801],[844,766],[835,733],[822,696],[809,664],[787,592],[773,542],[759,508],[750,479],[739,438],[722,393],[713,359],[706,326],[705,297],[699,264],[694,233],[687,204],[680,169],[672,136],[660,110],[654,91],[641,76],[629,64],[621,45],[619,28],[614,14],[603,1],[592,-18],[577,-32],[561,-38],[548,-40],[539,-45],[536,-54],[541,-62],[548,-77],[552,-94],[552,-110],[551,-119],[543,-124],[531,-122],[519,-121],[505,-128],[877,-128]];

        var triangles;

        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');

        var minX = Infinity,
            maxX = -Infinity,
            minY = Infinity,
            maxY = -Infinity;

        for (var i = 0; i < testPoints.length; i++) {
            minX = Math.min(minX, testPoints[i][0]);
            maxX = Math.max(maxX, testPoints[i][0]);
            minY = Math.min(minY, testPoints[i][1]);
            maxY = Math.max(maxY, testPoints[i][1]);
        }

        var width = maxX - minX,
            height = maxY - minY;

        canvas.height = window.innerHeight - 5;

        var ratio = (canvas.height - 5) / height;
        canvas.width = canvas.height * width / height + 5;

        if (devicePixelRatio > 1) {
            canvas.style.width = canvas.width + 'px';
            canvas.style.height = canvas.height + 'px';
            canvas.width *= 2;
            canvas.height *= 2;
            ctx.scale(2, 2);
        }

        console.time('earcut');
        // for (var i = 0; i < 1000; i++) {
        var triangles = earcut(testPoints);
        // }
        console.timeEnd('earcut');

        for (var i = 0; triangles && i < triangles.length; i += 3) {
            drawPoly(triangles.slice(i, i + 3), 'rgba(255,0,0,0.5)', 'rgba(255,255,0,0.5)');
            // drawPoly(triangles.slice(i, i + 3), 'rgba(255,0,0,0.0)', 'rgba(255,0,0,0.3)');
        }

        drawPoly(testPoints, 'black');

        function drawPoint(p, color) {
            var x = (p[0] - minX) * ratio + 5,
                y = (p[1] - minY) * ratio + 5;
            ctx.fillStyle = color || 'grey';
            ctx.fillRect(x - 3, y - 3, 6, 6);
        }

        function drawPoly(points, color, fill) {
            ctx.beginPath();

            ctx.strokeStyle = color;
            if (fill) ctx.fillStyle = fill;

            for (var i = 0; i < points.length; i++) {
                var x = (points[i][0] - minX) * ratio + 5,
                    y = (points[i][1] - minY) * ratio + 5;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.stroke();
            if (fill) ctx.fill();
        }
    </script>
</body>
</html>
